# 프로세스

## 프로그램 vs 프로세스

### 프로그램

저장장치에 저장되어 있는 실행되지 않은 정적인 상태이다.

### 프로세스

실행을 위해 메모리에 올라온 동적인 상태이다.



## PCB의 구성

### 프로세스 상태

프로세스의 상태에 대해 저장되어 있다.

### 프로세스 구분자

각 프로세스를 구분하는 id가 필요하다. (PID, PPID, CPID)

### 프로세스 카운트

다음에 실행될 명령어의 위치를 카리키는 프로그램 카운터의 값을 저장한다.

### 프로세스 우선순위

프로세스의 중요도가 각각 다르며, 일반적으로 사용자 프로세스보다 커널 프로세스가 우선순위가 높다.

### 메모리 관련 정보

프로세스가 메모리의 어디에 저장되어 있는지 저장되어있다. 메모리 보호를 위한 경계레지스터와 한계레지스터도 포함되어 있다.

### 각종 중간값

pcb에는 프로세스 실행 도중 사용된 중간값이 저장되어 있다.



## 프로세스의 다섯 가지 상태

생성상태, 준비상태, 실행상태, 완료상태, 대기상태로 구분된다.

### 생성 상태 

프로그램이 메모리에 올라오고, 운영체제로부터 pcb를 할당받은상태이다.

### 준비 상태

실행대기중인 모든 프로세스가 자기 순서를 기다리는 상태이다. ready queue에서 기다리며, cpu 스케쥴러에 의해 관리된다.

### 실행 상태

프로세스가 cpu를 할당받아 실행되는 상태이다.

### 대기 상태 

실행 상태에 있는 프로세스가 입출력이 완료될 때까지 기다리는 상태이다.

( 입출력이 되지 않아 기다리는 상태를 대기 상태라 하고, 이 상태가 없을 경우에는 입출력을 무한정 기다려야 한다. 또한, 입출력관리자의 인터럽트를 통해 ready queue로 가므로 전반적인 성능이 향상된다.)

### 완료 상태

완료상태는 프로세스가 종료되는 상태이다.



## 보류 상태와 휴식 상태

### 휴식 상태

프로세스가 작업을 일시적으로 쉬고 있는 상태이다.

### 보류 상태

프로세스가 메모리에서 잠시 쫓겨난 상태이다.



## 프로세스는 어떻게 여러 프로그램의 동시 사용을 지원하는가?

시분할 방식을 이용한다.



### 시분할 방식이란?

cpu의 작업시간을 나누어 프로세스에 시간을 할당하여 실행후 시간이 자나면 다른 프로세스를 실행하는 방식으로 구현된다. 주로 라운드 로빈 방식을 사용한다.



### 라운드 로빈이란?

각 프로세스에 동일한 크기의 할당시간을 부여하고, 할당시간이 지나면 프로세스가 선점 당한 후, ready queue의 마지막에 추가된다. CPU Burst가 각기 다른 프로세스가 많을 때 유용하다.

- 장점
  - 고아 개체가 생성되지 않고, 동일한 시간을 부여하므로 공정한 스케쥴링이 가능하다.
- 단점
  - 부여되는 시간이 길 경우 FCFS 와 동일해 질 수 있다. 또는, 부여 시간이 짧을 경우 문맥 교환(context switch)가 자주 일어나 부가적인 비용이 발생할 수 있다.
  - -> 부여되는 시간을 적절히 부여할 경우 단점이 상쇄가 가능하다.



번외)

##### 	FCFS 란

​		First Come First Served의 약자로 일반적인 큐와 같이 제일 먼저 들어온 것을 먼저 처리하는 방식을 말한다.







## Context Switch



Context Switch는 CPU를 차지하던 프로세스가 나가고, 새로운 프로세스를 받아들이는 작업이다.

실행 -> 타임아웃 -> 레디큐 상단의 프로세스 dispatch -> 실행 ... 의 과정을 통해 진행된다.



## 프로세스의 구조

### 코드 영역

텍스트 영역이라하며, 프로그램의 본문이 기술되어진 곳이다. 탑재된 프로그램의 본문은 읽기전용으로 처리된다.

### 데이터 영역

코드가 실행되면서 사용하는 변수나 파일등의 각종데이터를 모아 놓은 곳이다. 읽고 쓰기가 가능하나, 상수와 같이 읽기만 하는 변수도 저장된다.

### 스택 영역

프로세스를 실행하기 위해 부수적으로 필요한 데이터를 모아 놓은 곳이다.(각 종 함수의 )



## 프로세스의 생성과 복사

- 프로세스는 프로그램이 실행될 때 새로 생성된다.
- 사용자가 프로그램을 실행하면 운영체제는 프로그램을 메모리로 가져와 코드영역에 넣고 제어블록 생성
- 메모리에 데이터 영여고가 스택영역을 확보한 후 프로세스 실행



### fork()

fork 시스템 호출은 실행중인 프로세스에서 새로운 프로세스를 복사하는 함수이다. fork 로 프로세스를 생성할 경우 새로운 프로세스의 ppid는 기존 프로세스의 pid가 되고, 기존 프로세스의 cpid는 새로운 프로세스의 pid가 된다.

#### 장점

- 프로세스의 생성 속도가 빠르다.
- 추가 작업 없이 자원을 상속할 수 있다.
- 시스템 관리를 효율적으로 할 수 있다.
  - 부모프로세스와 자식프로세스로 연결되어 있어 자식 프로세스 종료시 자식이 사용하던 자원을 부모가 사용이 가능하다.



### exec()

exec는 기존의 프로세스를 새로운 프로세스로 전환하는 함수이다.

#### 장점

- 이미 만들어진 pcb, 메모리영역, 부모자식관계를 그대로 사용할 수 있어 성능에 이점이 있다.



## 프로세스의 계층구조

동시에 여러 작업을 처리하고, 종료된 프로세스의 자원을 회수하는데 유용하다.

#### 장점

- 여러 작업을 동시에 처리할 수 있다.
- 자원회수에 유리하다.





## 고아 프로세스

부모 프로세스가 먼저 종료되거나, 자식 프로세스가 비정상적으로 종료될 경우 사용하던 자원이 그대로 남는 것을 말한다.





> 참조
>
> 조성호/ 쉽게배우는 운영체제/ 한빛아카데미(2018)
>
> https://github.com/JaeYeopHan/Interview_Question_for_Beginner/tree/master/OS#cpu-%EC%8A%A4%EC%BC%80%EC%A4%84%EB%9F%AC ( round - robin & FCFS)